/* Generated from ubus IDL - {{ obj_name }} */

#ifndef {{ header_guard }}
#define {{ header_guard }}

#include <libubus.h>
#include <stdint.h>

/* Helper macros for optional field operations */
#define UBUS_IDL_HAS_FIELD(params, index) ((params)->has_fields & (1U << index))
#define UBUS_IDL_SET_FIELD(params, index) ((params)->has_fields |= (1U << index))
#define UBUS_IDL_CLEAR_FIELD(params, index) ((params)->has_fields &= ~(1U << index))

{# 定义可复用的结构体生成宏 #}
{% macro render_struct(struct_name, fields, has_optional) -%}
struct {{ struct_name }} {
{% for field in fields %}
    {{ field.c_type }} {{ field.name }};
{% endfor %}
{% if has_optional %}
    unsigned int has_fields;
{% endif %}
};
{%- endmacro %}

{# 所有结构体定义（全局类型、对象类型、方法参数结构体） #}
{% for struct_info in all_structs %}
{{ render_struct(struct_info.struct_name, struct_info.fields, struct_info.has_optional_fields) }}
{% endfor %}

{# 函数声明 - 所有处理器 #}
{% for method_info in all_methods %}
int {{ method_info.handler_name }}(struct ubus_context *ctx, struct ubus_object *obj, struct ubus_request_data *req, const char *method, struct blob_attr *msg);
{% endfor %}

{# 序列化/反序列化函数声明 #}
{% for type_info in serialize_types %}
int {{ type_info.deserialize_func }}(struct blob_attr *msg, struct {{ type_info.struct_type }} *params);
int {{ type_info.serialize_func }}(struct blob_buf *b, const struct {{ type_info.struct_type }} *params);
{% endfor %}

extern struct ubus_object {{ obj_name_lower }}_object;

#endif /* {{ header_guard }} */

